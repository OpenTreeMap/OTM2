{% extends "instance_base.html" %}
{% load i18n %}

{% block page_title %} | {% trans "Recent Edits" %} {{plot.pk}}{% endblock %}

{% block content %}

<h1>
{% trans "Recent Edits" %}
</h1>
<a href="{% url 'recent_edits' instance_id=request.instance.pk %}">Reset</a>

<table>
  <tr>
    <th>{% trans "Audit ID" %}</th>
    <th>{% trans "Model" %}</th>
    <th>{% trans "Model #" %}</th>
    <th>{% trans "Field" %}</th>
    <th>{% trans "Old Value" %}</th>
    <th>{% trans "Current Value" %}</th>
    <th>{% trans "Commit By" %}</th>
    <th>{% trans "Commit On" %}</th>
  </tr>
  {% for audit in audits %}
  <tr>
    <td>{{ audit.pk }}</td>
    <td>
      <a href="?models={{ audit.model }}">
      {{ audit.model }}
      </a>
    </td>
    <td>
      <a href="?models={{ audit.model }}&model_id={{ audit.model_id }}">
        {{ audit.model_id }}
      </a>
    </td>
    <td>{{ audit.field }}</td>

    {% if audit.field == 'user' %}

    <td>
      {% if audit.clean_previous_value %}
      <a href="?user={{ audit.clean_previous_value.pk }}">
        {{ audit.clean_previous_value }}
      </a>
      {% else %}
        None
      {% endif %}
    </td>
    <td>
      <a href="?user={{ audit.clean_current_value.pk }}">
        {{ audit.clean_current_value }}
      </a>
    </td>

    {% elif audit.field == 'plot' %}

    <td>
      {% if audit.clean_previous_value %}
      <a href="?models=Plot,id={{ audit.clean_previous_value.pk }}">
        Plot {{ audit.clean_previous_value }}
      </a>
      {% else %}
        None
      {% endif %}
    </td>
    <td>
      <a href="?models=Plot,id={{ audit.clean_current_value.pk }}">
        Plot {{ audit.clean_current_value }}
      </a>
    </td>

    {% elif audit.field == 'species' %}
    <td>
      {{ audit.clean_previous_value.scientific_name|default:"None" }}
    </td>
    <td>
      {{ audit.clean_current_value.scientific_name }}
    </td>

    {% elif audit.field == 'geom' %}
    <td>
      {{ audit.clean_previous_value.x|floatformat:0 }},
      {{ audit.clean_previous_value.y|floatformat:0 }}
    </td>
    <td>
      {{ audit.clean_current_value.x|floatformat:0 }},
      {{ audit.clean_current_value.y|floatformat:0 }}
    </td>
    {% else %}
    <td>{{ audit.clean_previous_value }}</td>
    <td>{{ audit.clean_current_value }}</td>
    {% endif %}

    <td>
      <a href="?user={{ audit.user.pk }}">
        {{ audit.user }}
      </a>
    </td>
    <td>
      {{ audit.created }}
    </td>
  </tr>
  {% endfor %}
</table>

{% if prev_page %}
<a href="{{ prev_page }}">&lt;&lt; {% trans "Previous" %}</a>
{% else %}
&lt;&lt; {% trans "Previous" %}
{% endif %}
|
{% if next_page %}
<a href="{{ next_page }}">{% trans "Next" %} &gt;&gt;</a>
{% else %}
{% trans "Next" %} &gt;&gt;
{% endif %}


{% endblock content %}
